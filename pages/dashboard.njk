{% extends "layout.njk" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<!-- Debug section -->
<div class="card">
  <h2>Debug Info</h2>
  <ul>
    <li>User: {{ user.display_name }}</li>
    <li>Streamer Connected: {{ streamerConnected }}</li>
    <li>Bot Connected: {{ botConnected }}</li>
    <li>Stream Online: {{ streamStatus.online }}</li>
    <li>Follower Count: {{ followerCount }}</li>
    <li>Chat Messages: {{ stats.chatMessages }}</li>
  </ul>
</div>

<!-- Welcome Card -->
<div class="card">
  <div class="card-header">
    <h1>Welcome to Enspira, {{ user.display_name }}</h1>
  </div>
  <p>Manage your Enspira AI assistant for your Twitch channel.</p>
  
  <!-- AI Assistant Settings -->
  <div class="two-column">
    <div class="card">
      <h2>Character Settings</h2>
      <p>Customize your AI assistant's personality, appearance, and behavior.</p>
      <a href="/web/character" class="btn btn-primary">Edit Character</a>
    </div>
    <div class="card">
      <h2>World Settings</h2>
      <p>Set up the environment and context for your AI assistant.</p>
      <a href="/web/world" class="btn btn-primary">Edit World</a>
    </div>
  </div>
</div>

<!-- Help Card -->
<div class="card">
  <h2>Still Confused?</h2>
  <p>Learn how to create your character and world in our help section.</p>
  <a href="/web/help" class="btn btn-primary">Get Help</a>
</div>

<!-- Stream Status Card -->
<div class="card">
  <h2>Stream Status</h2>
  <p>Stream Online: {{ streamStatus.online ? 'Yes' : 'No' }}</p>
  {% if streamStatus.online %}
    <div>
      <p>Title: {{ streamStatus.title }}</p>
      <p>Game: {{ streamStatus.game }}</p>
      <p>Viewers: {{ streamStatus.viewers }}</p>
      <p>Duration: {{ streamStatus.duration }}</p>
    </div>
  {% else %}
    <div>
      <p>Last Game: {{ lastGame }}</p>
    </div>
  {% endif %}
  <p>Followers: {{ followerCount }}</p>
</div>

<!-- Twitch Integration Card -->
<div class="card">
  <h2>Twitch Integration</h2>
  <p>Connect your Twitch streamer and bot accounts.</p>
  <div class="two-column">
    <div>
      <h3>Streamer Account</h3>
      {% if streamerConnected %}
        <p class="alert alert-success">Connected as: {{ streamerName }}</p>
      {% else %}
        <p class="alert alert-error">Not connected</p>
      {% endif %}
      <a href="/api/v1/auth/twitch/connect?type=streamer" class="btn btn-secondary">
        {% if streamerConnected %}Reconnect Streamer Account{% else %}Connect Streamer Account{% endif %}
      </a>
    </div>
    <div>
      <h3>Bot Account</h3>
      {% if botConnected %}
        <p class="alert alert-success">Connected as: {{ botName }}</p>
      {% else %}
        <p class="alert alert-error">Not connected</p>
      {% endif %}
      <a href="/api/v1/auth/twitch/connect?type=bot" class="btn btn-secondary">
        {% if botConnected %}Reconnect Bot Account{% else %}Connect Bot Account{% endif %}
      </a>
    </div>
  </div>
</div>

<!-- Quick Stats Card -->
<div class="card">
  <h2>Quick Stats</h2>
  <div class="two-column">
    <div>
      <h3>Chat Messages</h3>
      <p>{{ stats.chatMessages }} messages processed</p>
    </div>
    <div>
      <h3>Status</h3>
      <p>
        {% if streamStatus.online %}
          <span class="alert alert-success" style="padding: 4px 8px">Online</span>
        {% else %}
          <span class="alert alert-error" style="padding: 4px 8px">Offline</span>
        {% endif %}
      </p>
    </div>
  </div>
</div>
{% endblock %}